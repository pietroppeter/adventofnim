<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>2020\day03.nim</title>
  <!-- https://css-tricks.com/emojis-as-favicons/ changed font-size to 80 to fit whale-->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üê≥</text></svg>">
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel='stylesheet' href='https://unpkg.com/normalize.css/'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.min.css">
  <link rel='stylesheet' href='../static/androidstudio.css'>
  <script src="../static/highlight.nim.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
<style>
a {
    text-decoration: none;
    color: #009900;
}

a:hover {
    color: #99ff99;
}

em {
    color: #ffffff;
    font-style: normal;
    text-shadow: 0 0 5px #ffffff;
}

em.star {
  font-style: normal;
  color: #ffff66;
  text-shadow: 0 0 5px #ffff66;
}
</style>
</head>
<body>
<header><nav><em class="star"><a href="https://pietroppeter.github.io/adventofnim/index.html">üéÑüëë adventofnim</a></em></header>
<hr><main>
<h1>--- Example ---</h1>
<pre><code class="nim">let example = """..##.......
#...#...#..
.#....#..#.
..#.#...#.#
.#...##..#.
..#.##.....
.#.#.#....#
.#........#
#.##...#...
#...##....#
.#..#...#.#""".strip
echo example</code></pre>
<pre><samp>..##.......
#...#...#..
.#....#..#.
..#.#...#.#
.#...##..#.
..#.##.....
.#.#.#....#
.#........#
#.##...#...
#...##....#
.#..#...#.#</samp></pre>
<pre><code class="nim">type
  StrideMap = object
    data: seq[char]
    stride: int
    height: int

  Shape = tuple[stride, height: int]
proc parse(text: string): StrideMap =
  for line in text.splitLines:
    inc result.height
    result.data.add toSeq(line)
    if result.stride > 0 and line.len != result.stride:
      echo "ParseError: line does not matches stride"
    result.stride = line.len

let map0 = parse example
func shape(m: StrideMap): Shape =
  (m.stride, m.height)

echo "shape:", map0.shape</code></pre>
<pre><samp>shape:(stride: 11, height: 11)</samp></pre>
<p>let's add coordinates:</p>
<pre><code class="nim">type
  Point = tuple[x, y: int]
proc index(p: Point; m: StrideMap): int =
  var x = p.x mod m.stride
  if p.y >= m.height:
    echo "ERROR: point too low!"
  x + p.y * m.stride

proc `[]`(m: StrideMap; p: Point): char =
  m.data[p.index m]

for p in [(3, 1), (6, 2)]:
  echo p
  echo "index: ", p.index(map0)
  echo "on map: ", map0[p]</code></pre>
<pre><samp>(3, 1)
index: 14
on map: .
(6, 2)
index: 28
on map: #</samp></pre>
<pre><code class="nim">type
  Slope = tuple[dx, dy: int]
  Path = seq[Point]
  Ride = tuple[path: Path, ntrees: int]
proc `+`(p: Point; s: Slope): Point =
  result.x = p.x + s.dx
  result.y = p.y + s.dy

proc ride(m: StrideMap; s: Slope): Ride =
  var p: Point
  let ySteps = m.height div s.dy
  for i in 1 ..< ySteps:
    p = p + s
    result.path.add p
    if m[p] == '#':
      inc result.ntrees

let ride0 = ride(map0, (3, 1))
echo "ntrees: ", ride0.ntrees</code></pre>
<pre><samp>ntrees: 7</samp></pre>
<h2>--- Part 1 ---</h2>
<p>now we are equipped to solve part1:</p>
<pre><code class="nim">let
  input = "2020/input03.txt".readFile
  map1 = parse input
  ride1 = ride(map1, (3, 1))
echo "part1: ", ride1.ntrees</code></pre>
<pre><samp>part1: 205</samp></pre>
<p>That's the right answer! You are <em class="star">one gold star</em> closer to saving your vacation.</p>
<h2>--- Part 2 ---</h2>
<p>easy second part</p>
<p>tricky last slope made me discover my implementation bug!</p>
<p>now onto part2 on my puzzle input</p>
<pre><code class="nim">part2 = 1
for slope in slopes:
  part2 *= ride(map1, slope).ntrees
echo "part2: ", part2</code></pre>
<pre><samp>part2: 3952146825</samp></pre>
<p>That's the right answer! You are <em class="star">one gold star</em> closer to saving your vacation.</p>
<h1>Visualizations</h1>
<p>I want to try to take advantage of the fact that I output html.</p>
<p>I will reproduce the explantory design showing the ride through the example.</p>
<pre><code class="nim">proc show(m: StrideMap; r: Ride; repeat = 6) =
  var line = ""
  var
    i = 0
    j = 0
    p: Point = r.path[j]
    c: char
  for y in 0 ..< m.height:
    for x in 0 ..< m.stride:
      line.add m.data[i]
      inc i
    line = line.repeat(repeat)
    if y == p.y:
      c = if m[p] == '.':
        'O' else:
        'X'
      line = line[0 ..< p.x] & "<em>" & $c & "</em>" & line[p.x + 1 .. ^1]
      inc j
      if j < r.path.len:
        p = r.path[j]
    echo line
    line = ""

show(map0, ride0)
echo map1.shape</code></pre>
<pre><samp>..##.........##.........##.........##.........##.........##.......
#..<em>O</em>#...#..#...#...#..#...#...#..#...#...#..#...#...#..#...#...#..
.#....<em>X</em>..#..#....#..#..#....#..#..#....#..#..#....#..#..#....#..#.
..#.#...#<em>O</em>#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#
.#...##..#..<em>X</em>...##..#..#...##..#..#...##..#..#...##..#..#...##..#.
..#.##.......#.<em>X</em>#.......#.##.......#.##.......#.##.......#.##.....
.#.#.#....#.#.#.#.<em>O</em>..#.#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#
.#........#.#........<em>X</em>.#........#.#........#.#........#.#........#
#.##...#...#.##...#...#.<em>X</em>#...#...#.##...#...#.##...#...#.##...#...
#...##....##...##....##...#<em>X</em>....##...##....##...##....##...##....#
.#..#...#.#.#..#...#.#.#..#...<em>X</em>.#.#..#...#.#.#..#...#.#.#..#...#.#
(stride: 31, height: 323)</samp></pre>

</main>
<hr>
<small>
<p>github repo for all my solutions: üéÑüëë<a href="https://github.com/pietroppeter/adventofnim">adventofnim</a>;</p>
<p>html output powered by üê≥<a href="https://github.com/pietroppeter/nimib">nimib</a>.</p>
</small>
</body>
</html>